
# ğŸš€ Guia de MigraÃ§Ã£o - AuthContext Unificado

## ğŸ“‹ Resumo
VocÃª vai substituir **3 arquivos** por **1 Ãºnico contexto centralizado**.

---

## ğŸ—‚ï¸ PASSO 1: Criar o Novo Arquivo

### Criar: `src/contexts/AuthContext.tsx`
Copie o cÃ³digo do artifact "AuthContext - SoluÃ§Ã£o Completa Unificada"

---

## ğŸ”„ PASSO 2: Atualizar o Layout

### Editar: `app/layout.tsx` (ou `src/app/layout.tsx`)

```typescript
import { AuthProvider } from '@/src/contexts/AuthContext'
import './globals.css'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="pt-BR">
      <body>
        <AuthProvider>
          {children}
        </AuthProvider>
      </body>
    </html>
  )
}
```

---

## ğŸ” PASSO 3: Encontrar Todos os Imports

### No terminal, execute:
```bash
# Encontrar todos os arquivos que usam os hooks antigos
grep -r "from.*useAuth" src/ --include="*.tsx" --include="*.ts"
grep -r "from.*usePermissions" src/ --include="*.tsx" --include="*.ts"  
grep -r "from.*useUIPermissions" src/ --include="*.tsx" --include="*.ts"
```

Ou no **VS Code**: `Ctrl + Shift + F` e buscar por cada import.

---

## âœï¸ PASSO 4: Atualizar TODOS os Imports

### âŒ ANTES (3 imports diferentes):
```typescript
import { useAuth } from '@/src/hooks/useAuth'
import { usePermissions } from '@/src/hooks/usePermissions'
import { useUIPermissions } from '@/src/hooks/useUIPermissions'
```

### âœ… DEPOIS (1 Ãºnico import):
```typescript
import { useAuth, usePermissions, useUIPermissions } from '@/src/contexts/AuthContext'
```

### SubstituiÃ§Ã£o AutomÃ¡tica (opcional):
```bash
# Substitui imports automaticamente em todos os arquivos
find src -type f \( -name "*.tsx" -o -name "*.ts" \) -exec sed -i \
  "s|from '@/src/hooks/useAuth'|from '@/src/contexts/AuthContext'|g" {} \;

find src -type f \( -name "*.tsx" -o -name "*.ts" \) -exec sed -i \
  "s|from '@/src/hooks/usePermissions'|from '@/src/contexts/AuthContext'|g" {} \;

find src -type f \( -name "*.tsx" -o -name "*.ts" \) -exec sed -i \
  "s|from '@/src/hooks/useUIPermissions'|from '@/src/contexts/AuthContext'|g" {} \;
```

---

## ğŸ—‘ï¸ PASSO 5: Remover Arquivos Antigos

### Deletar (ou renomear para .old):
```bash
# Renomear para backup
mv src/hooks/useAuth.ts src/hooks/useAuth.ts.old
mv src/hooks/usePermissions.ts src/hooks/usePermissions.ts.old
mv src/hooks/useUIPermissions.ts src/hooks/useUIPermissions.ts.old

# Ou deletar permanentemente
rm src/hooks/useAuth.ts
rm src/hooks/usePermissions.ts
rm src/hooks/useUIPermissions.ts
```

---

## âœ… PASSO 6: Testar

### Iniciar o servidor:
```bash
npm run dev
```

### Verificar no Console:
VocÃª deve ver:
- âœ… **1 cache hit** (ao invÃ©s de 50)
- âœ… **0 instÃ¢ncias mÃºltiplas**
- âœ… **Apenas 2-3 requisiÃ§Ãµes** no total

### Antes:
```
ğŸš¨ Nova instÃ¢ncia useAuth #1
ğŸš¨ Nova instÃ¢ncia useAuth #2
...
ğŸš¨ Nova instÃ¢ncia useAuth #51
ğŸ“¦ Cache hit (instÃ¢ncia #1): user-id
ğŸ“¦ Cache hit (instÃ¢ncia #2): user-id
...
ğŸ“¦ Cache hit (instÃ¢ncia #50): user-id
```

### Depois:
```
ğŸ” Buscando perfil: user-id
âœ… Last login atualizado
```

---

## ğŸ¯ PASSO 7: Verificar Funcionalidade

### Teste essas funcionalidades:
- [ ] Login funciona
- [ ] PermissÃµes funcionam (botÃµes aparecem/desaparecem corretamente)
- [ ] UI permissions funcionam
- [ ] Logout funciona
- [ ] AtualizaÃ§Ã£o de perfil funciona

---

## ğŸ“Š Resultado Esperado

| MÃ©trica | Antes | Depois | Melhoria |
|---------|-------|---------|----------|
| InstÃ¢ncias useAuth | **51** | **1** | **-98%** |
| Cache hits | **50** | **1** | **-98%** |
| RequisiÃ§Ãµes totais | 6-10 | 2-3 | **-70%** |
| Listeners | 51 | 1 | **-98%** |
| Re-renders | Muitos | MÃ­nimos | **-95%** |

---

## ğŸ› Troubleshooting

### Erro: "useAuth deve ser usado dentro de um AuthProvider"
**Causa:** Componente usando o hook fora do AuthProvider  
**SoluÃ§Ã£o:** Verificar se `<AuthProvider>` estÃ¡ no layout raiz

### Erro: "Cannot read property 'role' of null"
**Causa:** Tentando acessar dados antes do loading terminar  
**SoluÃ§Ã£o:** Sempre verificar `loading` ou `userProfile` antes de usar:
```typescript
const { userProfile, loading } = useAuth()

if (loading) return <div>Carregando...</div>
if (!userProfile) return null

// Agora pode usar userProfile.role com seguranÃ§a
```

### Imports nÃ£o atualizados
**Causa:** Ainda importando dos arquivos antigos  
**SoluÃ§Ã£o:** Buscar por `@/src/hooks/use` e atualizar todos

---

## ğŸ‰ Pronto!

Agora vocÃª tem:
- âœ… 1 Ãºnica fonte de verdade para autenticaÃ§Ã£o
- âœ… Todos os hooks centralizados
- âœ… 98% menos operaÃ§Ãµes desnecessÃ¡rias
- âœ… Performance otimizada
- âœ… CÃ³digo mais limpo e manutenÃ­vel